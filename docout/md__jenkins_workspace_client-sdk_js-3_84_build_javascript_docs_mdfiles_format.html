<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Zealcomm PureRTC: Format Description</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="zealcomm_logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Zealcomm PureRTC
   &#160;<span id="projectnumber">version&nbsp;3.4.1v</span>
   </div>
   <div id="projectbrief">Zealcomm PureRTC Client SDK for Javascript*</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md__jenkins_workspace_client-sdk_js-3_84_build_javascript_docs_mdfiles_format.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Format Description </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="audiolevel"></a>
Audio_Levels</h1>
<p>The format of Audio_Levels object is:<br/>
 </p>
<div class="fragment"><div class="line">Audio_Levels = {</div>
<div class="line">    <span class="stringliteral">&quot;audioInputLevels&quot;</span>:[{</div>
<div class="line">        <span class="stringliteral">&quot;ssrc&quot;</span>:id_of_audio_stream,</div>
<div class="line">        <span class="stringliteral">&quot;level&quot;</span>: level_value}, ...],</div>
<div class="line">    <span class="stringliteral">&quot;audioOutputLevels&quot;</span>: [{</div>
<div class="line">        <span class="stringliteral">&quot;ssrc&quot;</span>:id_of_audio_stream,</div>
<div class="line">        <span class="stringliteral">&quot;level&quot;</span>: level_value}, ...]}</div>
<div class="line">}</div>
</div><!-- fragment --><p> It is valid either audioInputLevels or audioOutputLevels member does not exist, or the value array of them is null.<br/>
 For API user who want to get the audio level from MIC, they can get the audioInputLevels array and from each item in the array, read the "level" value.<br/>
 For API users who want to get the audio level output to speaker, they can get the audioOutputLevels array from each item in the array, read the "level" value.<br/>
</p>
<h1><a class="anchor" id="parse"></a>
Parse and Understand the JS Statistics</h1>
<p>The caller of statistics API should setup a periodical timer, in which getConnectionStats API is called, and in the successCallback, you retrieve the Stat_Reports object and record the timestamp this report is returned. To parse the Stat_Reports object named Stats:<br/>
</p>
<ol type="1">
<li>Get the length of the reports:<br/>
 <div class="fragment"><div class="line">var statLength = Stats.length;</div>
</div><!-- fragment --></li>
<li>Retrieve each Report_Entry object by:<br/>
 <div class="fragment"><div class="line">var curStat = Stats[i];</div>
</div><!-- fragment --> where i=0 to statsLength-1;<br/>
</li>
<li>Get the report type of each Report_Entry object:<br/>
 <div class="fragment"><div class="line">var reportType = curStat.type;</div>
<div class="line">var curReport = curStat.stats;</div>
<div class="line">var <span class="keywordtype">id</span> = curStat.id;</div>
</div><!-- fragment --> There are 5 types of reports as supported by the JS SDK: ssrc_audio_send, ssrc_video_send, ssrc_audio_recv, ssrc_video_recv, and VideoBWE.<br/>
 For all ssrc_* types, the id field indicates the stream lable bounded to that ssrc. For VidoeBWE type, the id field is left as empty string.<br/>
</li>
<li>Proceed to proccess each Report_Entry object according to its type:<br/>
 <div class="fragment"><div class="line">  <span class="keywordflow">if</span> ( reportType == <span class="stringliteral">&quot;ssrc_audio_send&quot;</span> ){</div>
<div class="line">  　　<span class="comment">//This is bytes that has been sent for this audio stream after the peer connection is setup.</span></div>
<div class="line">    var bytes_sent = curReport.bytes_sent;</div>
<div class="line">    <span class="comment">//This is RTP packets that has been sent over for this audio stream after the peer connection is setup.</span></div>
<div class="line">    var packets_sent = curReport.packets_sent;</div>
<div class="line">    <span class="comment">//This is RTP packets that is lost for this audio stream after the peer connection is setup.</span></div>
<div class="line">    var packets_lost = curReport.packets_lost;</div>
<div class="line">    <span class="comment">//Round trip time in ms measured by the stack when retrieving the statistics for this audio stream.</span></div>
<div class="line">    var rtt_ms = curReport.rtt_ms;</div>
<div class="line">    <span class="comment">//Audio encoder used for this audio stream.</span></div>
<div class="line">    var codec_name = curReport.codec_name;</div>
<div class="line">  }</div>
<div class="line"> <span class="keywordflow">else</span> <span class="keywordflow">if</span> (reportType == <span class="stringliteral">&quot;ssrc_audio_recv&quot;</span> ){</div>
<div class="line">    <span class="comment">//This is bytes that has been received for this audio stream after the peer connection is setup;</span></div>
<div class="line">   　var bytes_recv = curReport.bytes_rcvd;</div>
<div class="line">   　<span class="comment">//This is RTP packets that has been received for this audio stream after the peer connection is setup.</span></div>
<div class="line">   　var packets_recv = curReport.packets_rcvd;</div>
<div class="line">   　<span class="comment">//This is RTP packets that has been lost for this audio stream after the peer connection is setup.</span></div>
<div class="line">  　 var packets_lost = curReport.packets_lost;</div>
<div class="line">  　 <span class="comment">//Current e2e delay in ms as estimated by the stack for this audio stream.</span></div>
<div class="line">  　 var delay_estimated_ms = curReport.delay_estimated_ms;</div>
<div class="line">  　 <span class="comment">//audio decoder used for this audio stream;</span></div>
<div class="line">  　 var codec_name = curReport.codec_name;</div>
<div class="line"> }</div>
<div class="line">　else <span class="keywordflow">if</span> ( reportType == <span class="stringliteral">&quot;ssrc_video_send&quot;</span> ){</div>
<div class="line">　   <span class="comment">//This is bytes that has been sent for this video stream after the peer connection is setup.</span></div>
<div class="line">    var bytes_sent = curReport.bytes_sent;</div>
<div class="line">    <span class="comment">//This is RTP packets that has been sent over for this video stream after the peer connection is setup.</span></div>
<div class="line">    var packets_sent = curReport.packets_sent;</div>
<div class="line">    <span class="comment">//This is RTP packets that is lost for this video stream after the peer connection is setup.</span></div>
<div class="line">    var packets_lost = curReport.packets_lost;</div>
<div class="line">    <span class="comment">//round trip time in ms measured by the stack when retrieving the statistics for this video stream.</span></div>
<div class="line">    var rtt_ms = curReport.rtt_ms;</div>
<div class="line">    <span class="comment">//video encoder used for this video stream.</span></div>
<div class="line">    var codec_name = curReport.codec_name;</div>
<div class="line">    <span class="comment">//FIR packets received from the remote end for this video stream afte the peer connection is setup.</span></div>
<div class="line">    var firs_rcvd = curReport.firs_rcvd;</div>
<div class="line">    <span class="comment">//NACK packets received from the remote end for this video stream after the peer connection is setup.</span></div>
<div class="line">    var nacks_rcvd = curReport.nacks_rcvd;</div>
<div class="line">    <span class="comment">//PLI packets received from the remote end for this video stream after the peer connection is setup.</span></div>
<div class="line">    var plis_rcvd = curReport.plis_rcvd;</div>
<div class="line">    <span class="comment">//current frame height that is sent to remote for this video stream. this is not neccessarily to be the capture frame height.</span></div>
<div class="line">    var send_frame_height = curReport.send_frame_height;</div>
<div class="line">    <span class="comment">//current frame width that is sent to remote for this video stream; this is not neccessarily to be the capture frame width.</span></div>
<div class="line">    var send_frame_width = curReport.send_frame_width;</div>
<div class="line">    <span class="comment">//current frame rate of the video stream sending to remote peer. This is not neccessarily to be the capture frame rate.</span></div>
<div class="line">    var framerate_sent = curReport.framerate_sent;</div>
<div class="line">    <span class="comment">// If there is a resolution degrade on the sent video stream, for example, from VGA to CIF, this field shows the reason for</span></div>
<div class="line">    <span class="comment">// most recent resolution change.</span></div>
<div class="line">    <span class="comment">// if last_adapt_reason = 1,  the resolution change is because of high CPU usage;</span></div>
<div class="line">    <span class="comment">// if last_adapt_reason = 2, the resolution change is caused by current available bandwidth for sending the stream is too low.</span></div>
<div class="line">    <span class="comment">// If last_adpat_reason = 3, the resolution change is view renderer is at heavy load.</span></div>
<div class="line">    <span class="comment">// If last_adapt_reason = 99, there is no resolution degrade recently.</span></div>
<div class="line">    var last_adapt_reason = curReport.adapt_reason;</div>
<div class="line">    <span class="comment">// how many resolution degradation has happend on this video stream since the peer connection is setup.</span></div>
<div class="line">    var adapt_changes = curReport.adapt_reason;</div>
<div class="line"> }</div>
<div class="line"> <span class="keywordflow">if</span> ( reportType == <span class="stringliteral">&quot;ssrc_video_recv&quot;</span>) {</div>
<div class="line"> 　　　<span class="comment">//This is bytes that has been received for this video stream after the peer connection is setup;</span></div>
<div class="line">    var bytes_recv = curReport.bytes_rcvd;</div>
<div class="line">    <span class="comment">//This is RTP packets that has been received for this video stream after the peer connection is setup.</span></div>
<div class="line">    var packets_recv = curReport.packets_rcvd;</div>
<div class="line">    <span class="comment">//This is RTP packets that has been lost for this video stream after the peer connection is setup.</span></div>
<div class="line">    var packets_lost = curReport.packets_lost;</div>
<div class="line">    <span class="comment">//Current e2e delay in ms as estimated by the stack for this video stream.</span></div>
<div class="line">    var current_delay_ms = curReport.current_delay_ms;</div>
<div class="line">    <span class="comment">//video decoder used for this video stream;</span></div>
<div class="line">    var codec_name = curReport.codec_name;</div>
<div class="line">    <span class="comment">//FIR packets sent from local end for this video stream afte the peer connection is setup.</span></div>
<div class="line">    var firs_sent = curReport.firs_sent;</div>
<div class="line">    <span class="comment">//NACK packets sent from local end for this video stream after the peer connection is setup.</span></div>
<div class="line">    var nacks_rcvd = curReport.nacks_rcvd;</div>
<div class="line">    <span class="comment">//PLI packets sent from local end for this video stream after the peer connection is setup.</span></div>
<div class="line">    var plis_rcvd = curReport.plis_rcvd;</div>
<div class="line">    <span class="comment">//current frame height that is received for this video stream.</span></div>
<div class="line">    var frame_height = curReport.frame_height;</div>
<div class="line">    <span class="comment">//current frame width that is received for this video stream.</span></div>
<div class="line">    var frame_width = curReport.frame_width;</div>
<div class="line">    <span class="comment">//current frame rate of the video stream received from remote peerr. This is not neccessarily to be the rendered frame rate.</span></div>
<div class="line">    var framerate_rcvd = curReport.framerate_rcvd;</div>
<div class="line">    <span class="comment">//current rendered frame rate on this video stream.  This is usually smaller or equal to received frame rate.</span></div>
<div class="line">    var framereate_output = curReport.framerate_output;</div>
<div class="line"> }</div>
<div class="line"> <span class="keywordflow">if</span> (reportType == <span class="stringliteral">&quot;VideoBWE&quot;</span>){</div>
<div class="line"> 　　　<span class="comment">//the estimated available send bandwidth on local peer, in kbps.</span></div>
<div class="line">    var available_send_bandwidth = curReport.available_send_bandwidth;</div>
<div class="line">    <span class="comment">//the estimated avaiable receive bandwidth on local peer in kbps.</span></div>
<div class="line">    var available_recv_bandwidth = curReport.available_receive_bandwidth;</div>
<div class="line">    <span class="comment">//the current total sending bitrate of the video channels, in kbps;</span></div>
<div class="line">    var trasmit_bitrate = curReport.transmit_bitrate;</div>
<div class="line">    <span class="comment">//the current total re-trasmitting bitrate of the video channels, in kbps</span></div>
<div class="line">    var retransmit_bitrate = curReport.retransmit_bitrate;</div>
<div class="line"> }</div>
</div><!-- fragment --></li>
</ol>
<h1><a class="anchor" id="status"></a>
How to Analyze the Connection Status</h1>
<ol type="1">
<li>To analyze the average outgoing bitrate of all video streams on local peer during checkpoint time A and B (B&gt;A)<br/>
<ul>
<li>Get all ssrc report of type "ssrc_video_send" at time A, sum up the .bytes_sent on those reports as A.total_bytes_sent;<br/>
</li>
<li>Get all ssrc report of type "ssrc_video_send" at time B, sum up the .bytes_sent on those reports as B.total_bytes_sent;<br/>
</li>
<li>Calcluate the average sending bitrate during A and B by: AvgVideoSentKbps = (B.total_bytes_sent - A.total_bytes_sent)/(B-A);<br/>
</li>
</ul>
</li>
</ol>
<p>If AvgVideoSentKbps is much smaller than bandwidth preset for this peerclient, it will indicate connection is not good or the endpoint processing capability is not good.<br/>
</p>
<ol type="1">
<li>To analyze the packet lost ratio of the network for all outgoing video streams during checkpoint time A and B (B&gt;A)<br/>
<ul>
<li>Get all ssrc report of type "ssrc_video_send" at time A, sum up the .packets_lost and .packets_sent as A.total_packets_lost and A.total_packets_sent;<br/>
</li>
<li>Get all ssrc report of type "ssrc_video_send" at time B, sum up the .packets_lost and .packets_sent as B.total_packets_lost and B.total_packets_sent;<br/>
</li>
<li>Calculate the packet lost ratio during A and B by:AvgPkgLossRatio = (B.total_packets_lost-A.total_packets_lost)/(B.total_packets_sent - A.total_packets_sent);<br/>
 Non-zero packet loss ratio indicates the outgoing link status is not good.<br/>
</li>
</ul>
</li>
<li>To analyze the RTT for each sending video stream, and estimated delay for receiving each video stream <br/>
<ul>
<li>At each checkpoint, you get .rtt_ms of each ssrc_video_send report;<br/>
</li>
<li>At each checkpoint, you get .current_delay_ms for each ssrc_video_recv report. High RTT and delay indicates band network condition, that the network latency is high.<br/>
</li>
</ul>
</li>
<li>When packet lost ratio is high, you can check the RTCP feedbacks during time period A and B.<br/>
<ul>
<li>On ssrc_video_send report, if you continuously get a lot of PLIs/FIRs/NACKs during A and B by checking .plis_rcvd/firs_rcvd/nacks_rcvd delta , this indicates how the receiver is responding to the packet loss.<br/>
</li>
<li>On ssrc_video_recv report, if you continously get a lot of PLIs/FIRs/NACKS during A and B by checking .plis_sent/firs_sent/nacks_sent delta, this indicates how local receiver is resonding to the packet loss.<br/>
</li>
</ul>
</li>
<li>When you observe bad image quality as reflected by the remote peer, you can check locally for the possible reason: <br/>
<ul>
<li>On ssrc_video_send report, check the .adapt_reason field. If adapt_reason = 1, this indicates your local host is not capable to handle higher resolution due to heavy workload, so it degrades the resolution. If adapt_reason = 2, this indicates the local stack detects the available send/receive bandwidth for outgoing stream is not sufficient to maintian current resolution. if adapt_reason = 3, this indicates the local stack's rendering system is not capable of maintianing high resolution due to heavy workload. <br/>
</li>
<li>You can further check the sent frame rate and frame resolution by check .send_frame_width/send_frame_height/framerate_sent.<br/>
</li>
</ul>
</li>
<li>The VideoBWE report type also helps to indicate the estimated available bandwidth and actual bandwidth for the video engine:<br/>
<ul>
<li>Get the estimated bandwidth your local peer can accept/send video streams by checking .available_receive_bandwidth &amp; .available_send_bandwidth;<br/>
</li>
<li>Get the current acutal total send/retransimit bandwidth that flows over the video engine by checking .trasmit_bitrate &amp; .retrasmit_bitrate;<br/>
 It's suggested you use the bytes_sent field of each ssrc_video_send to get details of each stream, instead of relying on VideoBWE as the indicator.<br/>
</li>
</ul>
</li>
<li>To analyze the average incoming bitrate of all video streams on local peer during checkpoint time A and B (B&gt;A)<br/>
<ul>
<li>Get all ssrc report of type "ssrc_video_recv" at time A, sum up the .bytes_rcvd on those reports as A.total_bytes_rcvd;<br/>
</li>
<li>Get all ssrc report of type "ssrc_video_recv" at time B, sum up the .bytes_rcvd on those reports as B.total_bytes_rcvd;<br/>
</li>
<li>Calcluate the average receiving bitrate during A and B by: AvgVideoRecvKbps = (B.total_bytes_rcvd - A.total_bytes_rcvd)/(B-A);<br/>
 If AvgVideoRcvdKbps is much smaller than bandwidth preset for remote peerclient, it will indicate connection is not good or the endpoint processing capability is not good.<br/>
</li>
</ul>
</li>
<li>To analyze the packet lost ratio of the network for all incoming video streams during checkpoint time A and B (B&gt;A)<br/>
<ul>
<li>Get all ssrc report of type "ssrc_video_rcvd" at time A, sum up the .packets_lost and .packets_rcvd as A.total_packets_lost and A.total_packets_rcvd;<br/>
</li>
<li>Get all ssrc report of type "ssrc_video_rcvd" at time B, sum up the .packets_lost and .packets_rcvd as B.total_packets_lost and B.total_packets_rcvd;<br/>
</li>
<li>Calculate the packet lost ratio during A and B by: AvgPkgLossRatio = (B.total_packets_lost-A.total_packets_lost)/(B.total_packets_sent - A.total_packets_sent);<br/>
</li>
</ul>
</li>
</ol>
<p>Non-zero packet loss ratio indicates the incoming link stus not good.<br/>
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Mar 16 2018 15:14:53 for Zealcomm PureRTC version&nbsp;3.4.1v</li>
  </ul>
</div>
</body>
</html>
